<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vokabeltrainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
      flex-direction: column;
    }

    #container {
      width: 350px;
      background-color: white;
      padding: 30px 20px;
      border-radius: 8px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
      height: auto;
    }

    button,
    select {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      font-size: 1rem;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    .hidden {
      display: none;
    }

    #progress {
      display: flex;
      margin-top: 20px;
      height: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
    }

    .progress-segment {
      flex: 1;
      background-color: #ddd;
    }

    .progress-correct {
      background-color: #4caf50;
    }

    .progress-incorrect {
      background-color: #f44336;
    }

    #choices {
      display: grid;
      grid-template-columns: 150px 150px;
      grid-template-rows: 150px 150px;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    #choices button {
      width: auto;
      height: 150px;
      font-size: 1.5em;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background-color: #eee69d;
      color: rgb(2, 1, 1);
      transition: background-color 0.3s;
    }

    #choices button:hover {
      background-color: #ebde6a;
    }

    #abortButton {
      margin-top: 20px;
      padding: 5px 15px;
      font-size: 0.8rem;
      cursor: pointer;
      background-color: #b7b7b7;
      color: rgb(9, 5, 5);
      border: none;
      width: auto;
      position: absolute;
      bottom: -40px;
      right: 20px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    #abortButton:hover {
      background-color: #d5d5d5;
    }

    #knowButtons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    #knowButton,
    #dontKnowButton,
    #flipButton {
      width: 45%;
      height: 4.5em;
      padding: 10px;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background-color: #eee69d;
      transition: background-color 0.3s;
    }

    #knowButton:hover,
    #dontKnowButton:hover {
      background-color: #ebde6a;
    }

    #flipButton {
      width: 93%;
    }

    #vocabulary,
    #question {
      font-size: 2.2em;
    }

    .large-text {
      font-size: 62px !important;
      padding: 15px;
    }
  </style>
</head>

<body>
  <div id="container">
    <!-- Vokabelset auswählen Button -->
    <div id="fileselect">
      <button onclick="selectVocabularyFile()">Vokabelset auswählen</button>
      <input type="file" id="fileInput" class="hidden" accept=".txt" />
    </div>
    <!-- Einstellungen -->
    <div id="settings">
      <label for="direction">Übersetzungsrichtung:</label>
      <select id="direction" class="large-text">
        <option value="de-en">Deutsch -> Englisch</option>
        <option value="en-de">Englisch -> Deutsch</option>
      </select>

      <label for="mode">Übungsmodus:</label>
      <select id="mode" class="large-text">
        <option value="flashcard">Karteikarten</option>
        <option value="multiple-choice">Multiple Choice</option>
      </select>

      <button onclick="startTraining()">Start</button>
    </div>

    <!-- Karteikarten-Modus -->
    <div id="flashcard-mode" class="hidden">
      <p id="vocabulary"></p>
      <button id="flipButton" onclick="flipCard()">Karte umdrehen</button>
      <div id="knowButtons">
        <button id="knowButton" class="hidden" onclick="markKnown(true)">Kann ich</button>
        <button id="dontKnowButton" class="hidden" onclick="markKnown(false)">Kann ich nicht</button>
      </div>
    </div>

    <!-- Multiple-Choice-Modus -->
    <div id="multiple-choice-mode" class="hidden">
      <div id="progress"></div>
      <p id="question"></p>
      <div id="choices"></div>
    </div>

    <!-- Abbrechen-Button -->
    <button id="abortButton" onclick="confirmEndTraining()" class="hidden">Abbrechen</button>
  </div>

  <script>
    let vocabularyList = [];
    let currentMode = "";
    let direction = "de-en";
    let currentVocab = null;
    let correctAnswers = 0;
    let currentIndex = 0;
    let progressSegments = [];

    function selectVocabularyFile() {
      document.getElementById("fileInput").click();
    }

    document.getElementById("fileInput").addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const content = e.target.result;
          parseVocabulary(content);
          document.getElementById("settings").classList.remove("hidden");
        };
        reader.readAsText(file);
      }
    });

    function parseVocabulary(content) {
      vocabularyList = content
        .trim()
        .split("\n")
        .map(line => {
          const [deutsch, englisch] = line.split(" - ").map(word => word.trim());
          return { deutsch, englisch, score: 0 };
        });
    }

    function confirmEndTraining() {
      if (confirm("Möchten Sie das Training wirklich abbrechen?")) {
        endTraining();
      }
    }

    function startTraining() {
      document.getElementById("fileselect").classList.add("hidden");

      direction = document.getElementById("direction").value;
      currentMode = document.getElementById("mode").value;
      correctAnswers = 0;
      currentIndex = 0;

      document.getElementById("settings").classList.add("hidden");
      document.getElementById("abortButton").classList.remove("hidden");

      if (currentMode === "flashcard") {
        startFlashcardMode();
      } else if (currentMode === "multiple-choice") {
        startMultipleChoiceMode();
      }
    }

    function startFlashcardMode() {
      document.getElementById("flashcard-mode").classList.remove("hidden");
      selectNextFlashcard();
    }

    function selectNextFlashcard() {
      const totalScore = vocabularyList.reduce((acc, vocab) => acc + (10 - vocab.score), 0);
      let random = Math.random() * totalScore;
      for (let vocab of vocabularyList) {
        random -= (10 - vocab.score);
        if (random <= 0) {
          setFlashcard(vocab);
          return;
        }
      }
    }

    function setFlashcard(vocab) {
      currentVocab = vocab;
      document.getElementById("vocabulary").innerText =
        direction === "de-en" ? vocab.deutsch : vocab.englisch;
      document.getElementById("flipButton").classList.remove("hidden");
      document.getElementById("knowButton").classList.add("hidden");
      document.getElementById("dontKnowButton").classList.add("hidden");
    }

    function flipCard() {
      document.getElementById("vocabulary").innerText =
        direction === "de-en" ? currentVocab.englisch : currentVocab.deutsch;
      document.getElementById("flipButton").classList.add("hidden");
      document.getElementById("knowButton").classList.remove("hidden");
      document.getElementById("dontKnowButton").classList.remove("hidden");
    }

    function markKnown(isKnown) {
      if (isKnown) {
        currentVocab.score = Math.min(currentVocab.score + 1, 10);
      } else {
        currentVocab.score = Math.max(currentVocab.score - 1, 0);
      }
      selectNextFlashcard();
    }

    function startMultipleChoiceMode() {
      document.getElementById("multiple-choice-mode").classList.remove("hidden");
      initializeProgressBar();
      loadMultipleChoiceQuestion();
    }

    function initializeProgressBar() {
      const progressContainer = document.getElementById("progress");
      progressContainer.innerHTML = "";
      progressSegments = [];

      vocabularyList.forEach(() => {
        const segment = document.createElement("div");
        segment.classList.add("progress-segment");
        progressContainer.appendChild(segment);
        progressSegments.push(segment);
      });
    }

    function loadMultipleChoiceQuestion() {
      if (currentIndex >= vocabularyList.length) {
        showResultDialog();
        return;
      }

      const vocab = vocabularyList[currentIndex];
      const correctAnswer = direction === "de-en" ? vocab.englisch : vocab.deutsch;
      const questionText = direction === "de-en" ? vocab.deutsch : vocab.englisch;

      document.getElementById("question").innerText = questionText;

      const choices = [correctAnswer];
      while (choices.length < 4) {
        const randomChoice =
          vocabularyList[Math.floor(Math.random() * vocabularyList.length)][
          direction === "de-en" ? "englisch" : "deutsch"
          ];
        if (!choices.includes(randomChoice)) {
          choices.push(randomChoice);
        }
      }
      choices.sort(() => Math.random() - 0.5);

      document.getElementById("choices").innerHTML = choices
        .map(
          (choice) =>
            `<button onclick="checkAnswer(this, '${choice}', '${correctAnswer}')">${choice}</button>`
        )
        .join("");
    }

    function checkAnswer(button, selected, correct) {
      if (selected === correct) {
        button.classList.add("correct");
        progressSegments[currentIndex].classList.add("progress-correct");
        correctAnswers++;
      } else {
        button.classList.add("incorrect");
        progressSegments[currentIndex].classList.add("progress-incorrect");
      }

      setTimeout(() => {
        button.classList.remove("correct", "incorrect");
        currentIndex++;
        loadMultipleChoiceQuestion();
      }, 1000);
    }

    function showResultDialog() {
      alert(
        `Herzlichen Glückwunsch! Sie haben ${correctAnswers} von ${vocabularyList.length} Vokabeln korrekt übersetzt.`
      );
      endTraining();
    }

    function endTraining() {
      document.getElementById("abortButton").classList.add("hidden");
      document.getElementById("settings").classList.remove("hidden");
      document.getElementById("flashcard-mode").classList.add("hidden");
      document.getElementById("multiple-choice-mode").classList.add("hidden");
      document.getElementById("fileselect").classList.remove("hidden");
    }
  </script>
</body>

</html>